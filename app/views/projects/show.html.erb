<h1><%= @project.name %></h1>

<div class="project-users">
  <div class="add-users">
    <% if current_user.friends.size > 0 %>
      <table class="table table-striped">
        <thead>
          <tr>
            <th colspan="3" class="page-header">
              <h2>Friends</h2>
            </th>
          </tr>
          <tr>
            <th>Name</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% current_user.friends.each do |friend| %>
            <tr>
              <td><%= friend.full_name.present? ? friend.full_name : friend.email %></td>
              <td>
                <%= link_to "View Profile", user_path(friend), class: "btn btn-primary btn-xs" %>
                <% if @project.users.find_by(id: friend.id) or friend.id == current_user.id %>
                  <%= link_to "Remove User", user_project_delete_path(project_id: @project.id, friend_id: friend), method: :delete,
                    data: { confirm: "Are you sure?" }, class: "btn btn-xs btn-danger" %>
                <% else %>
                  <%= link_to "Add user", add_user_project_path(project_id: @project.id, friend_id: friend.id), method: :post, 
                          class: "btn btn-xs btn-primary" %>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>  
    <% else %>
      <div class="row col-lg-12">
        <p class="lead">
          You don't have any friends to add to this project, please add some
        </p>
      </div>
    <% end %>
  </div>
  <div class="project-current-users">
    <% if @project.users.size > 0 %>
      <table class="table table-striped">
        <thead>
          <tr>
            <th colspan="3" class="page-header">
              <h2>Project members</h2>
            </th>
          </tr>
          <tr>
            <th>Name</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @project.users.each do |user| %>
            <% if user.id == current_user.id %>
            <% else %>
              <tr>
                <td><%= user.full_name.present? ? user.full_name : user.email %></td>
                <td>
                  <%= link_to "View Profile", user_path(user), class: "btn btn-primary btn-xs" %>
                  <%= link_to "Remove User", user_project_delete_path(project_id: @project.id, friend_id: user.id), method: :delete,
                      data: { confirm: "Are you sure?" }, class: "btn btn-xs btn-danger" %>
                </td>
              </tr>
            <% end %>
          <% end %>
        </tbody>
      </table>  
    <% else %>
      <div class="row col-lg-12">
        <p class="lead">
          You don't have any users in this project, please add some
        </p>
      </div>
    <% end %>
  </div>
</div>
    
<button class="render-schedule btn">Render schedule</button>

<div class='project-schedule-container'>
<table class='project-schedule'>

  <tr class='row-top'>
    <th>Time:</th>
    <th>Monday</th>
    <th>Tuesday</th>
    <th>Wednesday</th>
    <th>Thursday</th>
    <th>Friday</th>
    <th>Saturday</th>
    <th>Sunday</th>
  </tr>

  <tr class='row-0'>
    <td>0:00-0:30</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-1'>
    <td>0:30-1:00</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-2'>
    <td>1:00-1:30</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-3'>
    <td>1:30-2:00</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-4'>
    <td>2:00-2:30</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-5'>
    <td>2:30-3:00</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-6'>
    <td>3:00-3:30</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-7'>
    <td>3:30-4:00</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-8'>
    <td>4:00-4:30</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-9'>
    <td>4:30-5:00</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-10'>
    <td>5:00-5:30</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-11'>
    <td>5:30-6:00</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-12'>
    <td>6:00-6:30</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-13'>
    <td>6:30-7:00</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-14'>
    <td>7:00-7:30</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-15'>
    <td>7:30-8:00</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-16'>
    <td>8:00-8:30</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-17'>
    <td>8:30-9:00</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-18'>
    <td>9:00-9:30</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-19'>
    <td>9:30-10:00</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-20'>
    <td>10:00-10:30</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-21'>
    <td>10:30-11:00</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-22'>
    <td>11:00-11:30</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-23'>
    <td>11:30-12:00</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-24'>
    <td>12:00-12:30</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-25'>
    <td>12:30-13:00</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-26'>
    <td>13:00-13:30</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-27'>
    <td>13:30-14:00</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-28'>
    <td>14:00-14:30</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-29'>
    <td>14:30-15:00</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-30'>
    <td>15:00-15:30</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-31'>
    <td>15:30-16:00</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-32'>
    <td>16:00-16:30</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-33'>
    <td>16:30-17:00</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-34'>
    <td>17:00-17:30</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-35'>
    <td>17:30-18:00</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-36'>
    <td>18:00-18:30</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-37'>
    <td>18:30-19:00</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-38'>
    <td>19:00-19:30</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-39'>
    <td>19:30-20:00</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-40'>
    <td>20:00-20:30</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-41'>
    <td>20:30-21:00</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-42'>
    <td>21:00-21:30</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-43'>
    <td>21:30-22:00</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-44'>
    <td>22:00-22:30</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-45'>
    <td>22:30-23:00</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-46'>
    <td>23:00-23:30</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>

  <tr class='row-47'>
    <td>23:30-24:00</td>
    <td class="Monday"></td>
    <td class="Tuesday"></td>
    <td class="Wednesday"></td>
    <td class="Thursday"></td>
    <td class="Friday"></td>
    <td class="Saturday"></td>
    <td class="Sunday"></td>
  </tr>
</table>
</div>

<script>
  
document.querySelector('.render-schedule').addEventListener('click', function(event) {
  <% if current_user.projects.find_by(id: @project.id)%>
    callEvents()
  <% else %>
    <% flash.now[:danger] = "You can only view the schedules of projects you are in" %>
  <% end %>
})
  
function callEvents() {
  <% @project.users.each do |user| %>
    <% user.events.each do |event| %>
        jsEventObject = new Object();
        jsEventObject.event_name =  '<%= event.event_name %>'
        jsEventObject.event_day = '<%= event.event_day %>'
        jsEventObject.start_index = '<%= event.start_index %>'
        jsEventObject.end_index = '<%= event.end_index %>'
        jsEventObject.color = '<%= event.event_color %>'
    
        startRow = document.querySelector('.row-' + jsEventObject.start_index)
        endRow = document.querySelector('.row-' + jsEventObject.end_index)
        startCell = startRow.getElementsByClassName(jsEventObject.event_day)
        startCell[0].innerText = "Busy"
        startCell[0].style.backgroundColor = '#d82b4e'
        for (let i = jsEventObject.start_index; i < jsEventObject.end_index; i++) {
          row = document.querySelector('.row-' + i);
          cell = row.getElementsByClassName(jsEventObject.event_day);
          cell[0].style.backgroundColor = '#d82b4e';

          cell[0].innerText = "Busy"
        }
    <% end %>
  <% end %>
      
}

</script>